const errorData = {
  msg: null,
  code: null
}

module.exports.setError = function(msg, code) {
  errorData.msg = msg
  errorData.code = code
}

let success = false

module.exports.succeeded = () => success
module.exports.reset = () => { success = false }

module.exports.create = function(opts, files, cb) {
  // Actual tar.create branches according to opts.file and opts.sync.
  // In some cases a Promise is returned, in others the callback is
  // called, in others ultimately nothing is returned.
  // opts.file is set to full path of package.tgz in git-offline.
  let err
  if (errorData.msg) {
    err = new Error(errorData.msg)
    if (errorData.code) err.code = errorData.code
  }
  else success = true
  const p = err ? Promise.reject(err) : Promise.resolve()
  return cb ? p.then(cb).catch(e => cb(e)) : p
}